pipeline{ 
    agent any
     environment {
        GOOGLE_PROJECT_ID = "capybarageocity" 
        APP_NAME = "Citizen 2024"
        GOOGLE_APPLICATION_CREDENTIALS = credentials('capybarageocity')
    }
    tools {
      terraform 'terraform'
    }
    stages{ 
		stage('Git Checkout'){
			steps {
				script {
					git branch: 'main', credentialsId: 'gitcreds', url: 'git@github.com:CapybaraDevOps/geocit.git'
				}
			}
		}
		stage('Terraform Init'){
			steps {
                withCredentials([file(credentialsId: 'capybarageocity', variable: 'GOOGLE_APPLICATION_CREDENTIALS')]) {
				cd terraform
                sh 'terraform init'
                }
			}
		}
        stage('Terraform Plan'){
			steps {
				sh 'terraform plan'
			}
		}
		stage('Terraform Apply'){
			steps {
				sh 'terraform apply --auto-approve'
			}
		}
    }  
}